<?php
namespace app;
use attr;
/** @var callable $§ */
$aside = !empty($§('entity')['attr']['aside']) ? attr\viewer($§('data'), $§('entity')['attr']['aside']) : null;
?>
<article id="<?=$§('id');?>" class="view<?php if ($aside):?> aside<?php endif;?>" data-entity="<?=$§('entity')['id'];?>">
    <?=§($§('id') . '-top');?>
    <?php foreach ($§('attr') as $attrId):?>
        <?php
        $attr = $§('entity')['attr'][$attrId] ?? null;
        $val = $§('data')[$attrId] ?? null;
        ?>
        <?php if (!$attr || $attr['id'] === 'aside' || $val === null || $val === '' || !($html = attr\viewer($§('data'), $attr))) continue;?>
        <?php if ($attr['id'] === 'name'):?>
    <h1 data-attr="<?=$attr['id'];?>" data-type="<?=$attr['type'];?>"><?=$html;?></h1>
        <?php elseif (in_array($attr['type'], ['date', 'datetime', 'time'])):?>
    <time data-attr="<?=$attr['id'];?>" data-type="<?=$attr['type'];?>"<?php if ($val !== $html):?> datetime="<?=$val;?>"<?php endif;?>><?=$html;?></time>
        <?php else:?>
    <div data-attr="<?=$attr['id'];?>" data-type="<?=$attr['type'];?>">
        <?=$html;?>
    </div>
        <?php endif;?>
    <?php endforeach;?>
    <?=§($§('id') . '-middle');?>
    <?php if ($aside):?>
    <aside data-attr="aside" data-type="<?=$§('entity')['attr']['aside']['type'];?>">
        <?=$aside;?>
    </aside>
    <?php endif;?>
    <?=§($§('id') . '-bottom');?>
</article>
